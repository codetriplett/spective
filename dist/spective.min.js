/*! spective 2019-03-07 */

!function(){"use strict";var o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};function T(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(){for(var e=[],i=[],t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){"object"===(void 0===t?"undefined":y(t))?(i=[function(t){var r=h({},t),e=r.scale;"number"==typeof e&&(r.scale=Array(3).fill(e));var i={};return["scale","angle","offset","heading","position"].forEach(function(n){var t=r[n];Array.isArray(t)&&t.forEach(function(t,e){var i=""+n+"XYZ"[e];"number"!=typeof r[i]&&(r[i]=t)})}),["scaleX","scaleY","scaleZ","angleX","angleY","angleZ","offsetX","offsetY","offsetZ","headingX","headingY","headingZ","positionX","positionY","positionZ"].forEach(function(t){var e=r[t];"number"==typeof e&&(i[t]=e)}),i}(t)],e.push(i)):i.push(t)}),e}var i=function(){function t(){u(this,t)}return e(t,[{key:"activate",value:function(){arguments.length&&(this.timestamp=Date.now(),this.queue=s.apply(void 0,arguments));var t=this.queue,e=!t.length,i=t.shift()||[],n=o(i,2),r=n[0],a=n[1];if(this.changes=r,this.iterator=a,this.duration=void 0,e)return this.timestamp=void 0,this.existing=void 0,this.looping=void 0,void(this.iteration=void 0);this.looping="function"==typeof a,this.iteration=-1,this.iterate(),arguments.length&&this.animate(this.timestamp)}},{key:"iterate",value:function(){this.existing=h({},this.properties),this.iteration++;var t=this.looping,e=this.iterator,i=this.iteration,n=this.duration;0<(n=t?e(i):i?0:e)?this.duration=n:(0===i&&this.interpolate(1),this.activate())}},{key:"interpolate",value:function(t){var e=this.existing,i=this.changes,n=this.properties,r=1-(this.looping?0:t);for(var a in i){var o=e[a]||0,s=i[a]*t;n[a]=o*r+s}}},{key:"animate",value:function(t){for(var e=this.timestamp,i=this.properties,n=this.duration,r=t-e;n<=r;)this.interpolate(1),this.timestamp+=n,r-=n,this.iterate(),n=this.duration;if(0<n){var a=r/n;this.interpolate(a)}this.calculate(i)}}]),t}(),x=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function l(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},u=arguments[1],c=arguments[2],e=t.positionX,i=t.positionY,n=t.positionZ,r=t.headingX,a=t.headingY,o=t.headingZ,s=t.offsetX,h=t.offsetY,l=t.offsetZ,f=t.angleX,v=t.angleY,p=t.angleZ,d=t.scaleX,m=t.scaleY,y=t.scaleZ,g=[[e,i,n].some(function(t){return void 0!==t})?[e,i,n]:void 0,o,r,a,[s,h,l].some(function(t){return void 0!==t})?[s,h,l]:void 0,p,f,v,[d,m,y].some(function(t){return void 0!==t})?[d,m,y]:void 0].map(function(t,e){var i=x.slice();if(void 0!==t){if(0<e&&e<4||4<e&&e<8){var n=Math.cos(t),r=Math.sin(u?-t:t),a=e%4,o=5*(a-1),s=3===a?-2:1;[n,r,-r,n].forEach(function(t,e){i[o+(2<=e?s<<2:0)+e%2*s]=t})}else{if(u&&c)return;8===e?t.forEach(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=arguments[1];i[5*e]=u?1/(t||1):t}):t.forEach(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1];i[12+e]=u?-t:t})}return i}});if(u&&!c){var b=g.splice(5,3),A=g.splice(1,3);g.reverse(),g.splice.apply(g,[2,0].concat(T(A))),g.splice.apply(g,[1,0].concat(T(b)))}return g.filter(function(t){return t})}function f(t){return t.reduce(function(t,e){if(!e)return t;for(var i=[],n=0;n<4;n++)for(var r=0;r<4;r++){for(var a=4*n,o=0,s=0;s<4;s++)o+=e[a+s]*t[4*s+r];i[a+r]=o}return i})}var g=function(t){function a(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];u(this,a);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return!0===t?r.inverted=!0:t instanceof a&&(t.children||(t.children=[]),t.children.push(r),r.anchor=t),r.properties={scaleX:1,scaleY:1,scaleZ:1},r.animations=[],i.length||(i=[{}]),r.activate.apply(r,T(i)),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,i),e(a,[{key:"calculate",value:function(t){var e=this.inverted,i=this.anchor,n=this.children,r=void 0===n?[]:n,a=void 0,o=void 0;if(t&&(a=l(t,e),o=l(t,!e,e),this.relativeMatrix=f(a),this.relativeInverse=f(o)),i){var s=i.relativeMatrix,u=i.relativeInverse,c=i.absoluteMatrix||s,h=i.absoluteInverse||u;this.absoluteMatrix=f([c,this.relativeMatrix]),this.absoluteInverse=f([h,this.relativeInverse])}r.forEach(function(t){return t.calculate()})}}]),a}(),c="0123456789abcdef";var v=/^(#[0-9a-f]{3}|#[0-9a-f]{6})$/,n=function(){function s(t){var i,n,e,r=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};if(u(this,s),v.test(t))this.image=(n=4<(i=t).length?1:0,e=[0,1,2].map(function(t){var e=1+(t<<n);return(c.indexOf(i[e])<<4)+c.indexOf(i[e+n])}),new Uint8Array([].concat(T(e),[255])));else{var o=new window.Image;o.src=t,o.addEventListener("load",function(){r.image=function(t){var e=t.width,i=t.height,n=m(e),r=m(i);if(n===e&&r===i)return t;var a=document.createElement("canvas"),o=a.getContext("2d");return a.width=n,a.height=r,o.drawImage(t,0,0,n,r),o.getImageData(0,0,n,r)}(o),a(t)}),o.addEventListener("error",function(){return a(t)})}this.instances=[]}return e(s,[{key:"createInstance",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=new(Function.prototype.bind.apply(g,[null].concat(e)));return this.instances.push(n),n}},{key:"destroyInstance",value:function(t,e){if(e){for(var i=t.anchor;i&&i!==e;)i=i.anchor;if(!i)return}var n=this.instances;n.splice(n.indexOf(t),1)}}]),s}();function M(t,e,i,n,r,a){return(t*(n-a)+i*(a-e)+r*(e-n))/2}function I(t){var e=Math.max.apply(Math,T(t.map(function(t){return Math.abs(t)})));return 0===e?t:t.map(function(t){return t/e})}function _(t){for(var e=t.length/3,i=[0,0,0],n=0;n<t.length;n+=3)i[0]+=t[n],i[1]+=t[n+1],i[2]+=t[n+2];return I(i.map(function(t){return t/e}))}function a(t,e,i){var n=t.match(new RegExp("(^|\n)"+e+" [^\n]+","g"));if(n)return n.map(function(t){return t.split(/ +/).slice(1).map(function(t){return i?t.split("/").map(function(t){return 0<t?t-1:Number(t)}):Number(t)})})}function p(t,i,n){var e;return(e=[]).concat.apply(e,T(t.map(function(t){var e=t[i];return n?n[e+(e<0?n.length:0)]:e})))}function d(t){var o=a(t,"v");if(o){var e,s=a(t,"vt"),u=a(t,"vn"),i=a(t,"f",!0),c=[],h=[],l=[],f=[];if(i.forEach(function(t){for(var e=t.length-1,i=1;i<e;i++){var n,r,a=[t[0],t[i],t[i+1]];if(c.push.apply(c,T(p(a,0))),h.push.apply(h,T(p(a,0,o))),s)(n=l).push.apply(n,T(p(a,1,s)));if(u)(r=f).push.apply(r,T(p(a,2,u)))}}),s||(l=h.filter(function(t,e){return e%3!=1}).map(function(t,e){return e%2==1?-t:t})),!u)f=function(t,e){for(var i,n,r,a=t.map(function(t){return t<0?e.length+t:t}),o=Math.max.apply(Math,T(a))+1,s=[],u=[],c=0;c<o;c++)u[c]=[];for(var h=0;h<a.length;h+=3){var l=a[h],f=a[h+1],v=a[h+2],p=3*l,d=3*f,m=3*v,y=e.slice(p,p+3),g=e.slice(d,d+3),b=e.slice(m,m+3),A=(n=g,r=b,I([M((i=y)[1],i[2],n[1],n[2],r[1],r[2]),M(i[2],i[0],n[2],n[0],r[2],r[0]),M(i[0],i[1],n[0],n[1],r[0],r[1])]));u[l]=u[l].concat(A),u[f]=u[f].concat(A),u[v]=u[v].concat(A)}u=u.map(_);for(var x=0;x<a.length;x+=3){var E=u[a[x]],w=u[a[x+1]],L=u[a[x+2]];s.push.apply(s,T(E).concat(T(w),T(L)))}return s}(c,(e=[]).concat.apply(e,T(o)));var n=Math.min.apply(Math,T(l)),r=Math.max.apply(Math,T(l));return{vertices:new Float32Array(h),coordinates:new Float32Array(l),normals:new Float32Array(f),repeatTexture:n<0||1<r}}}function m(t){return Math.pow(2,Math.ceil(Math.log2(t)))}var r=function(){function t(e){var i=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};u(this,t);var r=new XMLHttpRequest;r.onload=function(){var t=r.status;200!==t&&404!==t||(200===t&&Object.assign(i,d(r.responseText)),n(e))},r.open("GET",e),r.send(),this.assets={}}return e(t,[{key:"createAsset",value:function(t,e){var i=this.assets[t];return i||(i=new n(t,e),this.assets[t]=i),i}},{key:"destroyAsset",value:function(t,e){if(e)for(var i=this.assets[t],n=i.instances,r=n.length-1;0<=r;r--)i.destroyInstance(n[r],e);else delete this.assets[t]}}]),t}(),b=function(){function o(t,e){u(this,o);var i=t.getContext("webgl"),n=i.createProgram(),r=i.createShader(i.VERTEX_SHADER),a=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(r,"\n\tuniform mat4 uInstance;\n\tuniform mat4 uInverse;\n\tuniform mat4 uScene;\n\tuniform mat4 uPerspective;\n\n\tattribute vec3 aVertex;\n\tattribute vec3 aNormal;\n\tattribute vec2 aCoordinate;\n\n\tvarying vec3 vNormal;\n\tvarying vec3 vDirection;\n\tvarying vec2 vCoordinate;\n\n\tvoid main() {\n\t\tgl_Position = uPerspective * uScene * uInstance * vec4(aVertex, 1);\n\t\tvNormal = aNormal;\n\t\tvDirection = normalize(uInverse * vec4(1, 1, 1, 1)).xyz;\n\t\tvCoordinate = aCoordinate;\n\t}\n"),i.shaderSource(a,"\n\tprecision mediump float;\n\n\tuniform sampler2D uImage;\n\n\tvarying vec3 vNormal;\n\tvarying vec3 vDirection;\n\tvarying vec2 vCoordinate;\n\n\tvoid main() {\n\t\tfloat intensity = 0.5 + 0.5 * (dot(vDirection, vNormal) + 0.7) / 1.7;\n\t\tvec3 color = texture2D(uImage, vCoordinate).xyz * intensity;\n\t\tgl_FragColor = vec4(color, 1);\n\t}\n"),i.compileShader(r),i.compileShader(a),i.attachShader(n,r),i.attachShader(n,a),i.linkProgram(n),i.useProgram(n),i.enable(i.DEPTH_TEST),i.depthFunc(i.LESS),i.enable(i.CULL_FACE),i.cullFace(i.BACK),i.clearColor(0,0,0,1),this.setAttribute=this.setAttribute.bind(this),this.setSampler=this.setSampler.bind(this),this.resize=this.resize.bind(this),this.toggle=this.toggle.bind(this),this.render=this.render.bind(this),this.createGeometry=this.createGeometry.bind(this),this.destroyGeometry=this.destroyGeometry.bind(this),this.canvas=t,this.gl=i,this.camera=e,this.geometries={},this.instanceLocation=i.getUniformLocation(n,"uInstance"),this.inverseLocation=i.getUniformLocation(n,"uInverse"),this.sceneLocation=i.getUniformLocation(n,"uScene"),this.perspectiveLocation=i.getUniformLocation(n,"uPerspective"),this.imageLocation=i.getUniformLocation(n,"uImage"),this.vertexLocation=i.getAttribLocation(n,"aVertex"),this.normalLocation=i.getAttribLocation(n,"aNormal"),this.coordinateLocation=i.getAttribLocation(n,"aCoordinate")}return e(o,[{key:"setAttribute",value:function(t,e,i,n){var r=this.gl,a=r.ARRAY_BUFFER;return n=n||r.createBuffer(),r.bindBuffer(a,n),r.enableVertexAttribArray(t),r.bufferData(a,e,r.STATIC_DRAW),r.vertexAttribPointer(t,i,r.FLOAT,!1,0,0),n}},{key:"setSampler",value:function(t,e,i,n,r){var a=this.gl,o=a.TEXTURE_2D,s=a.RGBA,u=a.CLAMP_TO_EDGE,c=n instanceof Uint8Array,h=c?[n.length/4,1,0]:[];return r=r||a.createTexture(),a.activeTexture(a["TEXTURE"+e]),a.bindTexture(o,r),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D.apply(a,[o,0,s].concat(h,[s,a.UNSIGNED_BYTE,n])),c||(a.generateMipmap(o),a.texParameteri(o,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR)),i||(a.texParameteri(o,a.TEXTURE_WRAP_S,u),a.texParameteri(o,a.TEXTURE_WRAP_T,u)),a.uniform1i(t,e),r}},{key:"resize",value:function(){var t=this.render,e=this.canvas,i=this.gl,n=this.perspectiveLocation,r=e.clientWidth,a=e.clientHeight,o=Math.max(r,a);e.width=r,e.height=a,i.viewport(0,0,r,a),i.uniformMatrix4fv(n,!1,[o/r,0,0,0,0,o/a,0,0,0,0,-1,-1,0,0,-2,0]),t()}},{key:"toggle",value:function(){this.locked=!this.locked,this.locked||this.resize()}},{key:"render",value:function(t){if(this.locked)this.resolved=void 0;else{var e=this.render,h=this.setAttribute,l=this.setSampler,f=this.gl,i=this.camera,n=this.geometries,r=this.resolved,a=this.sceneLocation,v=this.vertexLocation,p=this.normalLocation,d=this.coordinateLocation,m=this.imageLocation,y=this.instanceLocation,g=this.inverseLocation;if(void 0===r||void 0!==t&&!r){f.clear(f.COLOR_BUFFER_BIT),f.clear(f.DEPTH_BUFFER_BIT);var b=Date.now(),A=!0;i.timestamp&&(i.animate(b),A=A&&!i.timestamp),f.uniformMatrix4fv(a,!1,i.relativeMatrix),Object.values(n).forEach(function(t){var e=t.vertices,i=t.normals,n=t.coordinates,r=t.repeatTexture,a=t.assets,o=t.vertexBuffer,s=t.normalBuffer,u=t.coordinateBuffer;if(e){var c=e.length/3;t.vertexBuffer=h(v,e,3,o),t.normalBuffer=h(p,i,3,s),t.coordinateBuffer=h(d,n,2,u),Object.values(a).forEach(function(t){var e=t.image,i=t.instances,n=t.imageTexture;e&&(t.imageTexture=l(m,0,r,e,n),i.forEach(function(t){t.timestamp&&(t.animate(b),A=A&&!t.timestamp);var e=t.absoluteMatrix,i=t.absoluteInverse,n=t.relativeMatrix,r=t.relativeInverse;f.uniformMatrix4fv(y,!1,e||n),f.uniformMatrix4fv(g,!1,i||r),f.drawArrays(f.TRIANGLES,0,c)}))})}}),this.resolved=A,window.requestAnimationFrame(e)}else this.resolved=void 0!==t&&void 0}}},{key:"createGeometry",value:function(t,e){var i=this.geometries[t];return i||(i=new r(t,e),this.geometries[t]=i),i}},{key:"destroyGeometry",value:function(t,e){if(e){var i=this.geometries[t],n=i.assets;for(var r in n)i.destroyAsset(r,e)}else delete this.geometries[t]}}]),o}();var A=function(){function r(){u(this,r);for(var t=[],e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];for(;"number"==typeof i.slice(-1)[0];)t.unshift(i.pop());this.value=0,this.index=0,this.segments=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var n=e[0],r=[],a=[],o=1;e.length;){var s=e.shift();"function"==typeof s?(a.push(s),r.push(o),o=1):"number"==typeof s&&(o=s)}1<r.length&&"function"==typeof n?r[0]=0:r.length||r.push(o);var u=0,c=void 0;return r.map(function(t,e){var i={lowerValue:u,lowerCallback:c};return u+=t,c=a[e],h({},i,{upperValue:u,upperCallback:c})})}.apply(void 0,i),this.measure=this.measure.bind(this),this.resolve=this.resolve.bind(this),this.update=this.update.bind(this),this.update.apply(this,t)}return e(r,[{key:"measure",value:function(){var t=Date.now(),e=this.fromValue,i=this.toValue,n=this.duration,r=this.timestamp,a=void 0===r?t:r;if(void 0===e||void 0===i)return this.value;var o=n?(Date.now()-a)/n:1,s=e*(1-(o=Math.min(Math.max(0,o),1)))+i*o;return this.value=s}},{key:"resolve",value:function(){var t=this.update,e=this.index,i=this.segments,n=this.duration,r=this.iterator,a=this.fromValue,o=this.toValue,s=this.remainingChange,u=this.remainingDuration,c=i[e],h=c.lowerValue,l=c.lowerCallback,f=c.upperValue,v=c.upperCallback,p=e+r,d=void 0;f<=o&&1===r?d=v:o<=h&&-1===r?d=l:p-=r,this.value=o,d&&a!==o&&void 0!==n&&d(r),p!==e&&0<=p&&p<i.length?(this.index=p,t(s,u)):(this.fromValue=void 0,this.toValue=void 0,this.iterator=void 0,this.duration=void 0,this.timestamp=void 0,this.remainingChange=void 0,this.remainingDuration=void 0)}},{key:"update",value:function(t,e){if(isNaN(t))return this.value;var i=this.measure,n=this.resolve,r=this.value,a=this.index,o=this.segments,s=this.timeout,u=o[a],c=u.lowerValue,h=u.upperValue,l=1/t<0,f=void 0===e;clearTimeout(s),i();var v=r+t;if(f){var p=o.slice(-1)[0].upperValue;v=l?p+t:t}var d=Math.min(Math.max(c,v),h),m=0,y=void 0,g=v,b=void 0;return v!==r&&(m=v<r?-1:1),f||(g-=d,b=e-(y=Math.round(e*(d-r)/t))),this.fromValue=r,this.toValue=d,this.duration=y,this.iterator=m,this.remainingChange=g,this.remainingDuration=b,void 0===y?n():(this.timestamp=Date.now(),this.timeout=setTimeout(n,y)),this.value}}]),r}(),t=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=e[0];if(/function|number/.test(void 0===n?"undefined":y(n))){var r=new(Function.prototype.bind.apply(A,[null].concat(e)));return function(){return arguments.length?r.update.apply(r,arguments):r.measure()}}var a,o,s,u=n,c=!u||"function"!=typeof u.getContext;c?(a=document.createElement("canvas"),o=document.body,(s=document.createElement("style")).innerHTML="\n\t\tbody { margin: 0; }\n\t\tcanvas {\n\t\t\tdisplay: block;\n\t\t\twidth: 100vw;\n\t\t\theight: 100vh;\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t}\n\t",o.appendChild(s),o.appendChild(a),u=a):e.shift();var h=new(Function.prototype.bind.apply(g,[null].concat([!0],e))),l=new b(u,h),f=l.resize,v=l.toggle,p=l.render,d=l.createGeometry,m=l.destroyGeometry;return f(),c&&window.addEventListener("resize",f),function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];if(0===e.length)v();else{if("string"==typeof e[0])return function n(t){for(var e=arguments.length,i=Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var a=i.shift(),o=void 0;if("string"==typeof i[0])o=i.shift();else{if(!i.length)return void m(a,t);o="#fff"}var s=d(a,p);if(!i.length)return s.destroyAsset(o,t),void(Object.keys(s.assets).length||m(a,t));var u=s.createAsset(o,p),c=u.createInstance.apply(u,[t].concat(i));return p(),function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];if(e.length){if("string"==typeof e[0])return n.apply(void 0,[c].concat(e));c.activate.apply(c,e),p()}else u.destroyInstance(c),u.instances.length||(s.destroyAsset(o),Object.keys(s.assets).length||m(a))}}.apply(void 0,[!1].concat(e));h.activate.apply(h,e),p()}}};window.spective=t,"function"==typeof define&&define.amd&&define("spective",function(){return t})}();