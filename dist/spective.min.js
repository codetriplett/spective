//spective@v3.0.2
(()=>{var Pt=Object.defineProperty;var Tt=(i,t,e)=>t in i?Pt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var b=(i,t)=>()=>(i&&(t=i(i=0)),t);var Et=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var C=(i,t,e)=>(Tt(i,typeof t!="symbol"?t+"":t,e),e);function Ot(i){let t=i.slice(1).split("#"),e=[];for(let s of t){let o=s.split("");if(o.length<6){let[r,a,c]=o.splice(0,3);o.unshift(r,r,a,a,c,c)}let n=o.length%3;n===1?o.push(o[o.length-1]):n||o.push("f","f");for(let r of[0,2,4,6]){let a=parseInt(o[r],16),c=parseInt(o[r+1],16);e.push((a<<4)+c)}}return new Uint8Array(e)}function Lt(i,t=1,e=1,s=1,o=1){return i.map(([n,r])=>{let a=n/s,c=r/o,f=(n+t)/s,u=(r+e)/o;return[a,u,f,u,f,c,f,c,a,c,a,u]})}var Q,m,B=b(()=>{j();Q=class{constructor(t={}){this.texture=void 0,this.nodes=new Set,this.update(Object.assign(Q.defaultProps,t))}update(t={}){let{texture:e}=Object.assign(this,t);if(typeof e=="string")if(e.startsWith("#")){let s=Ot(e);this._texture=s,this._finalizeUpdate(t)}else{let s=new window.Image;s.src=e,this._texture=void 0,s.addEventListener("load",()=>{this.texture===e&&(this._texture=s,this._finalizeUpdate(t))});return}this._finalizeUpdate(t)}_finalizeUpdate(t){let{nodes:e,tags:s,cells:o,sx:n,sy:r,_texture:a}=this,c=!1;if("tags"in t&&s===t.tags){let{tags:f}=t,u=f.trim();this._tags=u?u.split(/\s+/):[]}if("cells"in t&&o===t.cells){let{cells:f}=t;this._cells=f?f.split(" ").map(u=>u.split(":").map(l=>Number(l))):[]}if("texture"in t||a&&"cells"in t){let f=a instanceof Uint8Array,u=f?a.length>>2:a?.width,l=f?1:a?.height;"sx"in this||(this.sx=n=u),"sy"in this||(this.sy=r=l),this._coordinates=Lt(this._cells,n,r,u,l),c=!0}if("ox"in t||"oy"in t)for(let f of e)f._origin=void 0;if("sx"in t||"sy"in t||c)for(let f of e)f._scale=void 0}add(t={}){return t instanceof P||(t=new P(t)),t.asset?.remove?.(t),t.asset=this,Object.assign(t,{_origin:void 0,_scale:void 0}),this.nodes.add(t),t}remove(t){t.asset=void 0,this.nodes.delete(t)}destroy(t){let{geometry:e,nodes:s}=this;e&&e!==t&&e.remove(this);for(let o of s)o.destroy(this)}},m=Q;C(m,"defaultProps",{tags:"",cells:"0:0"})});function W(...i){return i.reduce((t,e)=>[t[0]+e[0],t[1]+e[1]])}function R(...i){return i.reduce((t,e)=>{let s=[];for(let o=0;o<t.length;o+=2)s.push(t[o]*e[0]+t[o+1]*e[1],t[o]*e[2]+t[o+1]*e[3]);return s})}var ct=b(()=>{});var wt,F,P,j=b(()=>{B();ct();wt=[[0,0],[1,0],[1,1],[0,1]],F=class{constructor(t){Object.assign(this,F.defaultProps),this.nodes=new Set,t&&this.update(t)}update(t={}){"asset"in t&&(this.asset?.remove?.(this),t.asset.add(this)),"group"in t&&(this.group?.remove?.(this),t.group.add(this));let{oncollide:e,collisions:s}=Object.assign(this,t);if("tags"in t){let{tags:o}=t,n=o.trim();this._tags=n?n.split(/\s+/):[]}"oncollide"in t&&(e?s||(this.collisions=new Set):this.collisions=void 0),this._finalizeUpdate(t)}_finalizeUpdate(t){if(("ox"in t||"oy"in t)&&(this._origin=void 0),("px"in t||"py"in t)&&(this._position=void 0),"az"in t&&(this._rotation=void 0),("sx"in t||"sy"in t)&&(this._scale=void 0),"oxa"in t||"oya"in t||"pxa"in t||"pya"in t||"aza"in t||"sxa"in t||"sya"in t){let{oxa:e,oya:s,pxa:o,pya:n,aza:r,sxa:a,sya:c}=this;this._aActive=!!(e||s||o||n||r||a||c)}if("oxs"in t||"oys"in t||"pxs"in t||"pys"in t||"azs"in t||"sxs"in t||"sys"in t){let{oxs:e,oys:s,pxs:o,pys:n,azs:r,sxs:a,sys:c}=this;this._sActive=!!(e||s||o||n||r||a||c)}}add(t={}){return t instanceof F||(t=new F(t)),t.group?.remove?.(t),t.group=this,this.nodes.add(t),t}remove(t){t.group=void 0,this.nodes.delete(t)}destroy(t){let{group:e,asset:s,nodes:o}=this;e&&e!==t&&e.remove(this),s&&s!==t&&s.remove(this);for(let n of o)n.destroy(this)}find(t,e){let{nodes:s}=this,o=[];if(typeof t=="string"){let n=t.split(",").map(r=>r.trim().split(/\s+/).map(a=>a.split(".")));return this._findFromQueries(n,e)}else{if(typeof t!="function")return o;t(this)&&(o.push(this),e-=1)}for(let n of s){if(e<=0)break;let r=n.find(t,e);o.push(...r),e-=r.length}return o}_findFromQueries(t,e){let s=[],{_tags:o=[],asset:n,nodes:r}=this,a=n?[...n._tags,...o]:o,c=n?.type||"",f=[],u=!1;for(let[l,...x]of t){let[h,...d]=l;h!==c||!d.every(v=>a.some(U=>U===v))||(x.length?f.push(x):u=!0)}u&&(s.push(this),e-=1),f.push(...t);for(let l of r){if(e<=0)break;let x=l._findFromQueries(f,e);s.push(...x),e-=x.length}return s}paint(t={}){t instanceof m||(t=new m(t));let{asset:e}=this;return e&&e.nodes.delete(this),t.add(this),t}_applyPhysics(t,e){let{group:s,_lastPhysicsFrame:o}=this;if(o===e)return;s&&s._applyPhysics(t,e),this._lastPhysicsFrame=e;let{_aActive:n,_sActive:r,oxs:a,oys:c,pxs:f,pys:u,azs:l,sxs:x,sys:h}=this,d={};if(n){let{oxa:g,oya:L,pxa:T,pya:I,aza:N,sxa:k,sya:G}=this;g&&(d.oxs=a+=g*t),L&&(d.oys=c+=L*t),T&&(d.pxs=f+=T*t),I&&(d.pys=u+=I*t),N&&(d.azs=l+=N*t),k&&(d.sxs=x+=k*t),G&&(d.sys=h+=G*t)}else if(!r)return;let{ox:_,oy:v,px:U,py:A,az:w,sx:p,sy:y}=this;a&&(d.ox=_+a*t),c&&(d.oy=v+c*t),f&&(d.px=U+f*t),u&&(d.py=A+u*t),l&&(d.az=w+l*t),x&&(d.sx=p+x*t),h&&(d.sy=y+h*t),this.update(d)}_recalculate(t,e){let{group:s}=this;s&&s._recalculate(t,this);let{asset:o,nodes:n,_composite:r,_position:a,_origin:c,_rotation:f,_scale:u,_inverted:l}=this;if(r&&a&&c&&f&&u)return;if(this._lastCalculatedFrame=t,!f||!u){if(!f){let{az:h}=this,d=Math.cos(h),_=Math.sin(h);this._rotation=[d,-_,_,d]}if(!u){let{sx:h,sy:d}=this;o&&(h*=o.sx||1,d*=o.sy||1),this._scale=l?[1/h,0,0,1/d]:[h,0,0,d]}({_rotation:f,_scale:u}=this),this._matrix=l?R(u,f):R(f,u),c=void 0}let{_matrix:x}=this;if(this._composite=s?R(s._composite,x):x,!a||!r){let{px:h,py:d}=this,_=l?[-h,-d]:[h,d];s&&(_=R(_,s._composite),_=W(_,s._position)),this._position=_}if(!c||!r){let{ox:h,oy:d,_composite:_}=this;o&&(h+=o.ox||0,d+=o.oy||0),this._origin=R(l?[h,d]:[-h,-d],_)}for(let h of n)h._composite=void 0,h!==e&&h._recalculate(t,this)}_recalculateBoundaries(){let{_composite:t,_position:e,_origin:s,_boundaries:o}=this,n=wt.map(x=>{let h=R(x,t);return W(h,e,s)}),r=n.map(x=>x[0]),a=n.map(x=>x[1]),c=Math.min(...r),f=Math.max(...r),u=Math.min(...a),l=Math.max(...a);this._boundaries=[c,f,u,l]}},P=F;C(P,"defaultProps",{ox:0,oy:0,px:0,py:0,az:0,sx:1,sy:1,oxs:0,oys:0,oxa:0,oya:0,pxs:0,pys:0,pxa:0,pya:0,azs:0,aza:0,sxs:0,sys:0,sxa:0,sya:0,cell:0})});var St,$,E,H=b(()=>{B();St=[0,0,0,1,0,0,1,1,0,1,1,0,0,1,0,0,0,0],$=class{constructor(t={}){this.joints=Object.assign(new m,{geometry:this}),this.assets=new Set,this.update({...$.defaultProps,...t})}update(t={}){Object.assign(this,t),"mesh"in t&&(this._mesh=t.mesh)}add(t={}){if("texture"in t)t instanceof m||(t=new m(t));else{let e=this.joints.add(t);return e._recalculate(0),e}return t.geometry?.remove?.(t),t.geometry=this,this.assets.add(t),t}remove(t){this.assets.delete(t)}destroy(t){let{layer:e,assets:s}=this;e&&e!==t&&e.remove(this);for(let o of s)o.destroy(this)}},E=$;C(E,"defaultProps",{mesh:St})});var J,O,V=b(()=>{H();J=class{constructor(t={}){this.library=Object.assign(new E,{layer:this}),this.geometries=new Set,this.update({...J.defaultProps,...t})}update(t={}){Object.assign(this,t)}add(t={}){if("mesh"in t)t instanceof E||(t=new E(t));else return this.library.add(t);return t.layer?.remove?.(t),t.layer=this,this.geometries.add(t),t}remove(t){this.geometries.delete(t)}destroy(t){let{scene:e,geometries:s}=this;e&&e!==t&&e.remove(this);for(let o of s)o.destroy(this)}},O=J;C(O,"defaultProps",{parallax:1})});function ft(i,t,e){let s=i.createShader(e);return i.shaderSource(s,t),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)||(console.log(`Error compiling ${e===i.VERTEX_SHADER?"vertex":"fragment"} shader:`),console.log(i.getShaderInfoLog(s))),s}function Z(i){let t=i.createProgram(),e=ft(i,At,i.VERTEX_SHADER);e&&i.attachShader(t,e);let s=ft(i,bt,i.FRAGMENT_SHADER);return s&&i.attachShader(t,s),i.linkProgram(t),i.getProgramParameter(t,i.LINK_STATUS)||(console.log("Error linking shader program:"),console.log(i.getProgramInfoLog(t))),t}var At,bt,ut=b(()=>{At=`
	attribute vec3 aVertex;
	attribute vec2 aCoordinate;

	uniform mat2 uMatrix;
	uniform vec2 uPosition;
	uniform vec2 uOrigin;
	uniform float uLayerParallax;
	uniform float uLayerSquash;
	uniform float uLayerDepth;
	uniform mat2 uSceneMatrix;
	uniform vec2 uScenePosition;
	uniform vec2 uSceneOrigin;

	varying vec2 vCoordinate;

	void main() {
		vec2 sceneShift = (uScenePosition + uSceneOrigin) * uLayerParallax;
		vec2 vertex = aVertex.xy * uMatrix + uPosition + uOrigin + sceneShift;
		float depth = aVertex.z * uLayerSquash + uLayerDepth;
		gl_Position = vec4(vertex * uSceneMatrix, -depth, 1.0);
		vCoordinate = aCoordinate;
	}
`,bt=`
	precision mediump float;

	uniform sampler2D uImage;

	varying vec2 vCoordinate;

	void main() {
		vec4 pixel = texture2D(uImage, vCoordinate);
		gl_FragColor = pixel;
	}
`});function dt(i,t,e,s,o){let{ARRAY_BUFFER:n,STATIC_DRAW:r,FLOAT:a}=i;i.bindBuffer(n,e),i.enableVertexAttribArray(t),i.bufferData(n,new Float32Array(o),r),i.vertexAttribPointer(t,s,a,!1,0,0)}function ht(i,t,e,s){let o=[];for(let n of i){let{_lastCalculatedFrame:r,_boundaries:a}=n;if(r!==e){o.push(n);continue}for(let c of t){if(c===n)continue;let{_boundaries:f}=n,{_boundaries:u}=c,l=[u[1]-f[0],f[1]-u[0],u[3]-f[2],f[3]-u[2]],x=l.every(p=>p>=0);if(s){let[p,y,g,L]=l;l=[y,p,L,g];let T=n;n=c,c=T}let{collisions:h,oncollide:d}=n;if(x===h.has(c))continue;let _=Math.min(...l),v=l.indexOf(_),{param:U}=c,w=d({overlap:l,side:v,param:U,type:x?X:K,action:x?"collide":"separate",self:n,node:c});if(w){let p=v%2?-1:1,y={...w};v<2&&!("px"in y)?y.px=n.px+l[v]*p:v>1&&!("py"in y)&&(y.py=n.py+l[v]*p),n.update(y)}else x?h.add(c):h.delete(c)}}return o}var X,K,S,tt=b(()=>{j();V();ut();X="COLLIDE_ACTION",K="SEPARATE_ACTION";S=class extends P{constructor(t){super(),this.ui=Object.assign(new O,{scene:this}),this.layers=[],this._inverted=!0,t&&this.update(t)}update(t={}){if(Object.assign(this,t),this._finalizeUpdate(t),!("gl"in this)){let{density:e=2,canvas:s,width:o,height:n}=this;if(!s){let{width:c=640,height:f=360}=t;s=document.createElement("canvas"),document.body.appendChild(s),Object.assign(s,{width:Math.round(c*e),height:Math.round(f*e)}),Object.assign(s.style,{position:"absolute",left:"50vw",top:"0",width:`${c/f*100}vh`,height:"100vh",transform:"translateX(-50%)"})}o===void 0&&(o=s.width/e),n===void 0&&(n=s.height/e),this.asset={ox:0,oy:0,sx:o/2,sy:n/2};let r=s.getContext("webgl"),a=Z(r);r.clearColor(.5,.5,.5,.5),r.useProgram(a),this.gl=r,this.aVertex=r.getAttribLocation(a,"aVertex"),this.aCoordinate=r.getAttribLocation(a,"aCoordinate"),this.uMatrix=r.getUniformLocation(a,"uMatrix"),this.uPosition=r.getUniformLocation(a,"uPosition"),this.uOrigin=r.getUniformLocation(a,"uOrigin"),this.uLayerParallax=r.getUniformLocation(a,"uLayerParallax"),this.uLayerSquash=r.getUniformLocation(a,"uLayerSquash"),this.uLayerDepth=r.getUniformLocation(a,"uLayerDepth"),this.uSceneMatrix=r.getUniformLocation(a,"uSceneMatrix"),this.uScenePosition=r.getUniformLocation(a,"uScenePosition"),this.uSceneOrigin=r.getUniformLocation(a,"uSceneOrigin"),r.enable(r.DEPTH_TEST),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this._frameCount=0,setTimeout(()=>this._animate(),0),document.addEventListener("visibilitychange",()=>{document.hidden?this.pause():this.resume()})}}add(t={}){if("parallax"in t)t instanceof O||(t=new O(t));else return this.ui.add(t);let{layers:e}=this;return e.indexOf(t)===-1&&(t.scene?.remove?.(t),e.push(t)),t.scene=this,e.sort((s,o)=>s.parallax-o.parallax),t}remove(t){let{layers:e}=this,s=e.indexOf(t);s!==-1&&e.splice(s,1)}destroy(){for(let t of this.layers)t.destroy(this)}_renderGeometry(t){let{gl:e,aVertex:s,aCoordinate:o,uMatrix:n,uPosition:r,uOrigin:a}=this,{TEXTURE_2D:c,CLAMP_TO_EDGE:f,RGBA:u,TRIANGLES:l}=e;"_glBuffer"in t||(t._glBuffer=e.createBuffer());let{mesh:x,assets:h,_glBuffer:d}=t;dt(e,s,d,3,x);for(let _ of h){"_glTexture"in _||(_._glTexture=e.createTexture()),"_glBuffer"in _||(_._glBuffer=e.createBuffer());let{_texture:v,_coordinates:U,width:A,height:w,nodes:p,_glTexture:y,_glBuffer:g}=_;if(v===void 0)continue;let L=[];e.activeTexture(e.TEXTURE0),e.bindTexture(c,y),v instanceof Uint8Array?L=[A,w,0]:(e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(c,e.TEXTURE_WRAP_S,f),e.texParameteri(c,e.TEXTURE_WRAP_T,f)),e.texImage2D(c,0,u,...L,u,e.UNSIGNED_BYTE,v);for(let T of p){let{cell:I,_position:N,_origin:k,_composite:G}=T;dt(e,o,g,2,U[I]),e.uniformMatrix2fv(n,!1,G),e.uniform2fv(r,N),e.uniform2fv(a,k),e.drawArrays(l,0,6)}}}render(t){let{gl:e,ui:s,layers:o,_frameCount:n}=this,r=[...o,s],a=r.map(({library:p,geometries:y})=>{let g=[...p.joints.nodes];for(let{assets:L}of[p,...y])for(let{nodes:T}of L)g.push(...T);return g});this._applyPhysics(t,n);for(let p of a)for(let y of p)y._applyPhysics(t,n);this.ondraw&&this.ondraw(t,n);for(let p of a){let y=[],g=[];for(let T of p){let{param:I,oncollide:N}=T;!N&&I===void 0||(N&&y.push(T),I!==void 0&&g.push(T),T._recalculate(n),T._recalculateBoundaries(n))}let L=ht(y,g,n);ht(g,L,n,!0)}this._recalculate(n);for(let p of a)for(let y of p)y._recalculate(n);let{uSceneMatrix:c,uScenePosition:f,uSceneOrigin:u,uLayerParallax:l,uLayerSquash:x,uLayerDepth:h,_matrix:d,_position:_,_origin:v,_scale:U}=this;e.clear(e.COLOR_BUFFER_BIT),e.uniformMatrix2fv(c,!1,d),e.uniform2fv(f,_),e.uniform2fv(u,v);let A=2/r.length;e.uniform1f(x,A),e.depthMask(!0),e.disable(e.BLEND);let w=1-A/2;for(let p=r.length-1;p>=0;p--){let{parallax:y,geometries:g}=r[p];e.uniform1f(l,y),e.uniform1f(h,w),w-=A;for(let L of g)this._renderGeometry(L)}e.depthMask(!1),e.enable(e.BLEND),w=-1+A/2;for(let p of r){let{parallax:y,library:g}=p;p===s&&e.uniformMatrix2fv(c,!1,U),e.uniform1f(l,y),e.uniform1f(h,w),w+=A,this._renderGeometry(g)}this._frameCount++}_animate(t=0){this.render(t),requestAnimationFrame(e=>{if(this._paused)return;let{_previousTime:s=e}=this;this._previousTime=e;let o=(s&&e-s)/1e3;this._animate(o)})}resume(){this._paused&&(this._paused=!1,this._animate())}pause(){this._paused||(this._paused=!0,this._previousTime=void 0)}};C(S,"defaultProps",{})});function pt(i,t){z.add(i),i.activate(t)}function yt(i,t){z.delete(i),i.deactivate(t)}function _t({key:i,repeat:t},e){if(t)return;let s=lt[i];s&&e(s,{type:Y,input:"key",control:s})}function Ct(i,t){for(let e of xt){let[s,o,n,r,a]=e;if(!(i<o||i>r||t<n||t>a))return s}}function gt(i,t){let{changedTouches:[{pageX:e,pageY:s}]}=i,o=Ct(e,s);o&&(i.preventDefault(),t(o,{type:q,input:"touch",control:o}))}var z,lt,xt,Y,q,M,et=b(()=>{z=new Set,lt={},xt=[],Y="KEY_INPUT",q="TOUCH_INPUT";window.addEventListener("keydown",i=>_t(i,pt));window.addEventListener("keyup",i=>_t(i,yt));window.addEventListener("touchstart",i=>gt(i,pt),{passive:!1});window.addEventListener("touchend",i=>gt(i,yt),{passive:!1});M=class{constructor(t,e,s){let{key:o,touch:n}=t;if(o&&(lt[o]=this),n){let[r=0,a=1,c=0,f=1]=n;xt.unshift([this,r,c,r+a,c+f])}this.ondown=e,this.onup=s}activate(t){this.ondown(t)}deactivate(t){this.onup&&this.onup(t)}}});function Mt(i,t,e,s){if(e){e=new Set(e);let o=Object.entries(t).filter(([n,r])=>(e.delete(n),r!==i[n]&&(n.length>3||r!==void 0)));for(let n of e)o.push([n,s[n]]);if(!o.length)return;t=Object.fromEntries(o)}else{let o=t.id;o&&(!Object.prototype.hasOwnProperty.call(window,o)||window[o]._instance===i)&&(window[o]=i)}i.update(t)}function D(...i){let[t={}]=i;return"key"in t?new M(...i):new S(...i)}var Ut,It,st,it,ot,nt,rt,mt=b(()=>{tt();V();H();B();j();et();Ut={createTextNode(){},createDocumentFragment(){return{childNodes:[],appendChild(i){this.removeChild(i),this.childNodes.push(i),i.parentElement=this},insertBefore(i,t){let{childNodes:e}=this;this.removeChild(i);let s=e.indexOf(t);e.splice(s,0,i),i.parentElement=this},removeChild(i){let{childNodes:t}=this,e=t.indexOf(i);e!==-1&&(t.splice(e,1),i.parentElement=null)}}},createElement(i){i=i.toLowerCase();let t=new{scene:S,layer:O,geometry:E,asset:m,node:P}[i];return Object.assign(t,{tagName:i,childNodes:[],appendChild:e=>t.add(e),insertBefore:e=>t.add(e),removeChild:e=>e.destroy()})}};It={scene:S.defaultProps,layer:O.defaultProps,geometry:E.defaultProps,asset:m.defaultProps,node:P.defaultProps},st=[Ut,Mt,It],it=0,ot=1,nt=2,rt=3});var vt=b(()=>{tt();V();H();B();j();et();mt()});var Nt=Et((me,at)=>{vt();Object.assign(D,{Scene:S,Layer:O,Geometry:E,Asset:m,Node:P,Control:M,controls:z,framework:st,LEFT:it,RIGHT:ot,BOTTOM:nt,TOP:rt,COLLIDE_ACTION:X,SEPARATE_ACTION:K,KEY_INPUT:Y,TOUCH_INPUT:q});typeof window=="object"?window.spective=D:typeof at=="object"&&(at.exports=D)});Nt();})();
/*! For license information please see spective.min.js.LEGAL.txt */
