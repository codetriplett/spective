//spective@v3.0.2
(()=>{var ht=Object.defineProperty;var lt=(o,t,e)=>t in o?ht(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var A=(o,t)=>()=>(o&&(t=o(o=0)),t);var xt=(o,t)=>()=>(t||o((t={exports:{}}).exports,t),t.exports);var M=(o,t,e)=>(lt(o,typeof t!="symbol"?t+"":t,e),e);function pt(o){let t=o.slice(1).split("#"),e=[];for(let s of t){let i=s.split("");if(i.length<6){let[r,a,c]=i.splice(0,3);i.unshift(r,r,a,a,c,c)}let n=i.length%3;n===1?i.push(i[i.length-1]):n||i.push("f","f");for(let r of[0,2,4,6]){let a=parseInt(i[r],16),c=parseInt(i[r+1],16);e.push((a<<4)+c)}}return new Uint8Array(e)}function yt(o,t=1,e=1,s=1,i=1){return o.map(([n,r])=>{let a=n/s,c=r/i,f=(n+t)/s,d=(r+e)/i;return[a,d,f,d,f,c,f,c,a,c,a,d]})}var X,_,D=A(()=>{z();X=class{constructor(t={}){this.texture=void 0,this.nodes=new Set,this.update(Object.assign(X.defaultProps,t))}update(t={}){let{texture:e}=Object.assign(this,t);if(typeof e=="string")if(e.startsWith("#")){let s=pt(e);this._texture=s,this._finalizeUpdate(t)}else{let s=new window.Image;s.src=e,this._texture=void 0,s.addEventListener("load",()=>{this.texture===e&&(this._texture=s,this._finalizeUpdate(t))});return}this._finalizeUpdate(t)}_finalizeUpdate(t){let{nodes:e,tags:s,cells:i,sx:n,sy:r,_texture:a}=this,c=!1;if("tags"in t&&s===t.tags){let{tags:f}=t,d=f.trim();this._tags=d?d.split(/\s+/):[]}if("cells"in t&&i===t.cells){let{cells:f}=t;this._cells=f?f.split(" ").map(d=>d.split(":").map(l=>Number(l))):[]}if("texture"in t||a&&"cells"in t){let f=a instanceof Uint8Array,d=f?a.length>>2:a?.width,l=f?1:a?.height;"sx"in this||(this.sx=n=d),"sy"in this||(this.sy=r=l),this._coordinates=yt(this._cells,n,r,d,l),c=!0}if("ox"in t||"oy"in t)for(let f of e)f._origin=void 0;if("sx"in t||"sy"in t||c)for(let f of e)f._scale=void 0}add(t={}){return t instanceof P||(t=new P(t)),t.asset?.remove?.(t),t.asset=this,Object.assign(t,{_origin:void 0,_scale:void 0}),this.nodes.add(t),t}remove(t){t.asset=void 0,this.nodes.delete(t)}destroy(t){let{geometry:e,nodes:s}=this;e&&e!==t&&e.remove(this);for(let i of s)i.destroy(this)}},_=X;M(_,"defaultProps",{tags:"",cells:"0:0"})});function q(...o){return o.reduce((t,e)=>[t[0]+e[0],t[1]+e[1]])}function j(...o){return o.reduce((t,e)=>{let s=[];for(let i=0;i<t.length;i+=2)s.push(t[i]*e[0]+t[i+1]*e[1],t[i]*e[2]+t[i+1]*e[3]);return s})}var nt=A(()=>{});var mt,I,P,z=A(()=>{D();nt();mt=[[0,0],[1,0],[1,1],[0,1]],I=class{constructor(t){Object.assign(this,I.defaultProps),this.nodes=new Set,t&&this.update(t)}update(t={}){"asset"in t&&(this.asset?.remove?.(this),t.asset.add(this)),"group"in t&&(this.group?.remove?.(this),t.group.add(this));let{oncollide:e,collisions:s}=Object.assign(this,t);if("tags"in t){let{tags:i}=t,n=i.trim();this._tags=n?n.split(/\s+/):[]}"oncollide"in t&&(e?s||(this.collisions=new Set):this.collisions=void 0),this._finalizeUpdate(t)}_finalizeUpdate(t){if(("ox"in t||"oy"in t)&&(this._origin=void 0),("px"in t||"py"in t)&&(this._position=void 0),"az"in t&&(this._rotation=void 0),("sx"in t||"sy"in t)&&(this._scale=void 0),"oxa"in t||"oya"in t||"pxa"in t||"pya"in t||"aza"in t||"sxa"in t||"sya"in t){let{oxa:e,oya:s,pxa:i,pya:n,aza:r,sxa:a,sya:c}=this;this._aActive=!!(e||s||i||n||r||a||c)}if("oxs"in t||"oys"in t||"pxs"in t||"pys"in t||"azs"in t||"sxs"in t||"sys"in t){let{oxs:e,oys:s,pxs:i,pys:n,azs:r,sxs:a,sys:c}=this;this._sActive=!!(e||s||i||n||r||a||c)}}add(t={}){return t instanceof I||(t=new I(t)),t.group?.remove?.(t),t.group=this,this.nodes.add(t),t}remove(t){t.group=void 0,this.nodes.delete(t)}destroy(t){let{group:e,asset:s,nodes:i}=this;e&&e!==t&&e.remove(this),s&&s!==t&&s.remove(this);for(let n of i)n.destroy(this)}find(t,e){let{nodes:s}=this,i=[];if(typeof t=="string"){let n=t.split(",").map(r=>r.trim().split(/\s+/).map(a=>a.split(".")));return this._findFromQueries(n,e)}else{if(typeof t!="function")return i;t(this)&&(i.push(this),e-=1)}for(let n of s){if(e<=0)break;let r=n.find(t,e);i.push(...r),e-=r.length}return i}_findFromQueries(t,e){let s=[],{_tags:i=[],asset:n,nodes:r}=this,a=n?[...n._tags,...i]:i,c=n?.type||"",f=[],d=!1;for(let[l,...x]of t){let[h,...u]=l;h!==c||!u.every(v=>a.some(C=>C===v))||(x.length?f.push(x):d=!0)}d&&(s.push(this),e-=1),f.push(...t);for(let l of r){if(e<=0)break;let x=l._findFromQueries(f,e);s.push(...x),e-=x.length}return s}paint(t={}){t instanceof _||(t=new _(t));let{asset:e}=this;return e&&e.nodes.delete(this),t.add(this),t}_applyPhysics(t,e){let{group:s,_lastPhysicsFrame:i}=this;if(i===e)return;s&&s._applyPhysics(t,e),this._lastPhysicsFrame=e;let{_aActive:n,_sActive:r,oxs:a,oys:c,pxs:f,pys:d,azs:l,sxs:x,sys:h}=this,u={};if(n){let{oxa:g,oya:L,pxa:w,pya:R,aza:B,sxa:k,sya:G}=this;g&&(u.oxs=a+=g*t),L&&(u.oys=c+=L*t),w&&(u.pxs=f+=w*t),R&&(u.pys=d+=R*t),B&&(u.azs=l+=B*t),k&&(u.sxs=x+=k*t),G&&(u.sys=h+=G*t)}else if(!r)return;let{ox:m,oy:v,px:C,py:T,az:b,sx:p,sy:y}=this;a&&(u.ox=m+a*t),c&&(u.oy=v+c*t),f&&(u.px=C+f*t),d&&(u.py=T+d*t),l&&(u.az=b+l*t),x&&(u.sx=p+x*t),h&&(u.sy=y+h*t),this.update(u)}_recalculate(t,e){let{group:s}=this;s&&s._recalculate(t,this);let{asset:i,nodes:n,_composite:r,_position:a,_origin:c,_rotation:f,_scale:d,_inverted:l}=this;if(r&&a&&c&&f&&d)return;if(this._lastCalculatedFrame=t,!f||!d){if(!f){let{az:h}=this,u=Math.cos(h),m=Math.sin(h);this._rotation=[u,-m,m,u]}if(!d){let{sx:h,sy:u}=this;i&&(h*=i.sx||1,u*=i.sy||1),this._scale=l?[1/h,0,0,1/u]:[h,0,0,u]}({_rotation:f,_scale:d}=this),this._matrix=l?j(d,f):j(f,d),c=void 0}let{_matrix:x}=this;if(this._composite=s?j(s._composite,x):x,!a||!r){let{px:h,py:u}=this,m=l?[-h,-u]:[h,u];s&&(m=j(m,s._composite),m=q(m,s._position)),this._position=m}if(!c||!r){let{ox:h,oy:u,_composite:m}=this;i&&(h+=i.ox||0,u+=i.oy||0),this._origin=j(l?[h,u]:[-h,-u],m)}for(let h of n)h._composite=void 0,h!==e&&h._recalculate(t,this)}_recalculateBoundaries(){let{_composite:t,_position:e,_origin:s,_boundaries:i}=this,n=mt.map(x=>{let h=j(x,t);return q(h,e,s)}),r=n.map(x=>x[0]),a=n.map(x=>x[1]),c=Math.min(...r),f=Math.max(...r),d=Math.min(...a),l=Math.max(...a);this._boundaries=[c,f,d,l]}},P=I;M(P,"defaultProps",{ox:0,oy:0,px:0,py:0,az:0,sx:1,sy:1,oxs:0,oys:0,oxa:0,oya:0,pxs:0,pys:0,pxa:0,pya:0,azs:0,aza:0,sxs:0,sys:0,sxa:0,sya:0,cell:0})});var gt,Q,S,V=A(()=>{D();gt=[0,0,0,1,0,0,1,1,0,1,1,0,0,1,0,0,0,0],Q=class{constructor(t={}){this.joints=Object.assign(new _,{geometry:this}),this.assets=new Set,this.update({...Q.defaultProps,...t})}update(t={}){Object.assign(this,t),"mesh"in t&&(this._mesh=t.mesh)}add(t={}){if("texture"in t)t instanceof _||(t=new _(t));else{let e=this.joints.add(t);return e._recalculate(0),e}return t.geometry?.remove?.(t),t.geometry=this,this.assets.add(t),t}remove(t){this.assets.delete(t)}destroy(t){let{layer:e,assets:s}=this;e&&e!==t&&e.remove(this);for(let i of s)i.destroy(this)}},S=Q;M(S,"defaultProps",{mesh:gt})});var W,E,H=A(()=>{V();W=class{constructor(t={}){this.library=Object.assign(new S,{layer:this}),this.geometries=new Set,this.update({...W.defaultProps,...t})}update(t={}){Object.assign(this,t)}add(t={}){if("mesh"in t)t instanceof S||(t=new S(t));else return this.library.add(t);return t.layer?.remove?.(t),t.layer=this,this.geometries.add(t),t}remove(t){this.geometries.delete(t)}destroy(t){let{scene:e,geometries:s}=this;e&&e!==t&&e.remove(this);for(let i of s)i.destroy(this)}},E=W;M(E,"defaultProps",{parallax:1})});function rt(o,t,e){let s=o.createShader(e);return o.shaderSource(s,t),o.compileShader(s),o.getShaderParameter(s,o.COMPILE_STATUS)||(console.log(`Error compiling ${e===o.VERTEX_SHADER?"vertex":"fragment"} shader:`),console.log(o.getShaderInfoLog(s))),s}function Y(o){let t=o.createProgram(),e=rt(o,_t,o.VERTEX_SHADER);e&&o.attachShader(t,e);let s=rt(o,vt,o.FRAGMENT_SHADER);return s&&o.attachShader(t,s),o.linkProgram(t),o.getProgramParameter(t,o.LINK_STATUS)||(console.log("Error linking shader program:"),console.log(o.getProgramInfoLog(t))),t}var _t,vt,at=A(()=>{_t=`
	attribute vec3 aVertex;
	attribute vec2 aCoordinate;

	uniform mat2 uMatrix;
	uniform vec2 uPosition;
	uniform vec2 uOrigin;
	uniform float uLayerParallax;
	uniform float uLayerSquash;
	uniform float uLayerDepth;
	uniform mat2 uSceneMatrix;
	uniform vec2 uScenePosition;
	uniform vec2 uSceneOrigin;

	varying vec2 vCoordinate;

	void main() {
		vec2 sceneShift = (uScenePosition + uSceneOrigin) * uLayerParallax;
		vec2 vertex = aVertex.xy * uMatrix + uPosition + uOrigin + sceneShift;
		float depth = aVertex.z * uLayerSquash + uLayerDepth;
		gl_Position = vec4(vertex * uSceneMatrix, -depth, 1.0);
		vCoordinate = aCoordinate;
	}
`,vt=`
	precision mediump float;

	uniform sampler2D uImage;

	varying vec2 vCoordinate;

	void main() {
		vec4 pixel = texture2D(uImage, vCoordinate);
		gl_FragColor = pixel;
	}
`});function ct(o,t,e,s,i){let{ARRAY_BUFFER:n,STATIC_DRAW:r,FLOAT:a}=o;o.bindBuffer(n,e),o.enableVertexAttribArray(t),o.bufferData(n,new Float32Array(i),r),o.vertexAttribPointer(t,s,a,!1,0,0)}function ft(o,t,e,s){let i=[];for(let n of o){let{_lastCalculatedFrame:r,_boundaries:a}=n;if(r!==e){i.push(n);continue}for(let c of t){if(c===n)continue;let{_boundaries:f}=n,{_boundaries:d}=c,l=[d[1]-f[0],f[1]-d[0],d[3]-f[2],f[3]-d[2]],x=l.every(p=>p>=0);if(s){let[p,y,g,L]=l;l=[y,p,L,g];let w=n;n=c,c=w}let{collisions:h,oncollide:u}=n;if(x===h.has(c))continue;let m=Math.min(...l),v=l.indexOf(m),{param:C}=c,b=u({overlap:l,side:v,param:C,action:x?"collide":"separate",self:n,node:c});if(b){let p=v%2?-1:1,y={...b};v<2&&!("px"in y)?y.px=n.px+l[v]*p:v>1&&!("py"in y)&&(y.py=n.py+l[v]*p),n.update(y)}else x?h.add(c):h.delete(c)}}return i}var O,$=A(()=>{z();H();at();O=class extends P{constructor(t){super(),this.ui=Object.assign(new E,{scene:this}),this.layers=[],this._inverted=!0,t&&this.update(t)}update(t={}){if(Object.assign(this,t),this._finalizeUpdate(t),!("gl"in this)){let{density:e=2,canvas:s,width:i,height:n}=this;if(!s){let{width:c=640,height:f=360}=t;s=document.createElement("canvas"),document.body.appendChild(s),Object.assign(s,{width:Math.round(c*e),height:Math.round(f*e)}),Object.assign(s.style,{position:"absolute",left:"50vw",top:"0",width:`${c/f*100}vh`,height:"100vh",transform:"translateX(-50%)"})}i===void 0&&(i=s.width/e),n===void 0&&(n=s.height/e),this.asset={ox:0,oy:0,sx:i/2,sy:n/2};let r=s.getContext("webgl"),a=Y(r);r.clearColor(.5,.5,.5,.5),r.useProgram(a),this.gl=r,this.aVertex=r.getAttribLocation(a,"aVertex"),this.aCoordinate=r.getAttribLocation(a,"aCoordinate"),this.uMatrix=r.getUniformLocation(a,"uMatrix"),this.uPosition=r.getUniformLocation(a,"uPosition"),this.uOrigin=r.getUniformLocation(a,"uOrigin"),this.uLayerParallax=r.getUniformLocation(a,"uLayerParallax"),this.uLayerSquash=r.getUniformLocation(a,"uLayerSquash"),this.uLayerDepth=r.getUniformLocation(a,"uLayerDepth"),this.uSceneMatrix=r.getUniformLocation(a,"uSceneMatrix"),this.uScenePosition=r.getUniformLocation(a,"uScenePosition"),this.uSceneOrigin=r.getUniformLocation(a,"uSceneOrigin"),r.enable(r.DEPTH_TEST),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),this._frameCount=0,setTimeout(()=>this._animate(),0),document.addEventListener("visibilitychange",()=>{document.hidden?this.pause():this.resume()})}}add(t={}){if("parallax"in t)t instanceof E||(t=new E(t));else return this.ui.add(t);let{layers:e}=this;return e.indexOf(t)===-1&&(t.scene?.remove?.(t),e.push(t)),t.scene=this,e.sort((s,i)=>s.parallax-i.parallax),t}remove(t){let{layers:e}=this,s=e.indexOf(t);s!==-1&&e.splice(s,1)}destroy(){for(let t of this.layers)t.destroy(this)}_renderGeometry(t){let{gl:e,aVertex:s,aCoordinate:i,uMatrix:n,uPosition:r,uOrigin:a}=this,{TEXTURE_2D:c,CLAMP_TO_EDGE:f,RGBA:d,TRIANGLES:l}=e;"_glBuffer"in t||(t._glBuffer=e.createBuffer());let{mesh:x,assets:h,_glBuffer:u}=t;ct(e,s,u,3,x);for(let m of h){"_glTexture"in m||(m._glTexture=e.createTexture()),"_glBuffer"in m||(m._glBuffer=e.createBuffer());let{_texture:v,_coordinates:C,width:T,height:b,nodes:p,_glTexture:y,_glBuffer:g}=m;if(v===void 0)continue;let L=[];e.activeTexture(e.TEXTURE0),e.bindTexture(c,y),v instanceof Uint8Array?L=[T,b,0]:(e.texParameteri(c,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(c,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(c,e.TEXTURE_WRAP_S,f),e.texParameteri(c,e.TEXTURE_WRAP_T,f)),e.texImage2D(c,0,d,...L,d,e.UNSIGNED_BYTE,v);for(let w of p){let{cell:R,_position:B,_origin:k,_composite:G}=w;ct(e,i,g,2,C[R]),e.uniformMatrix2fv(n,!1,G),e.uniform2fv(r,B),e.uniform2fv(a,k),e.drawArrays(l,0,6)}}}render(t){let{gl:e,ui:s,layers:i,_frameCount:n}=this,r=[...i,s],a=r.map(({library:p,geometries:y})=>{let g=[...p.joints.nodes];for(let{assets:L}of[p,...y])for(let{nodes:w}of L)g.push(...w);return g});this._applyPhysics(t,n);for(let p of a)for(let y of p)y._applyPhysics(t,n);this.ondraw&&this.ondraw(t,n);for(let p of a){let y=[],g=[];for(let w of p){let{param:R,oncollide:B}=w;!B&&R===void 0||(B&&y.push(w),R!==void 0&&g.push(w),w._recalculate(n),w._recalculateBoundaries(n))}let L=ft(y,g,n);ft(g,L,n,!0)}this._recalculate(n);for(let p of a)for(let y of p)y._recalculate(n);let{uSceneMatrix:c,uScenePosition:f,uSceneOrigin:d,uLayerParallax:l,uLayerSquash:x,uLayerDepth:h,_matrix:u,_position:m,_origin:v,_scale:C}=this;e.clear(e.COLOR_BUFFER_BIT),e.uniformMatrix2fv(c,!1,u),e.uniform2fv(f,m),e.uniform2fv(d,v);let T=2/r.length;e.uniform1f(x,T),e.depthMask(!0),e.disable(e.BLEND);let b=1-T/2;for(let p=r.length-1;p>=0;p--){let{parallax:y,geometries:g}=r[p];e.uniform1f(l,y),e.uniform1f(h,b),b-=T;for(let L of g)this._renderGeometry(L)}e.depthMask(!1),e.enable(e.BLEND),b=-1+T/2;for(let p of r){let{parallax:y,library:g}=p;p===s&&e.uniformMatrix2fv(c,!1,C),e.uniform1f(l,y),e.uniform1f(h,b),b+=T,this._renderGeometry(g)}this._frameCount++}_animate(t=0){this.render(t),requestAnimationFrame(e=>{if(this._paused)return;let{_previousTime:s=e}=this;this._previousTime=e;let i=(s&&e-s)/1e3;this._animate(i)})}resume(){this._paused&&(this._paused=!1,this._animate())}pause(){this._paused||(this._paused=!0,this._previousTime=void 0)}};M(O,"defaultProps",{})});var N,K,U,J=A(()=>{N=new Set,K={};window.addEventListener("keydown",({key:o,repeat:t})=>{if(t)return;let e=K[o];e&&(N.add(e),e.activate())});window.addEventListener("keyup",({key:o})=>{let t=K[o];t&&(N.delete(t),t.deactivate())});U=class{constructor(t,e,s){let{key:i}=t;i&&(K[i]=this),this.ondown=e,this.onup=s}activate(){this.ondown()}deactivate(){this.onup&&this.onup()}}});function wt(o,t,e,s){if(e){e=new Set(e);let i=Object.entries(t).filter(([n,r])=>(e.delete(n),r!==o[n]&&(n.length>3||r!==void 0)));for(let n of e)i.push([n,s[n]]);if(!i.length)return;t=Object.fromEntries(i)}else{let i=t.id;i&&(!Object.prototype.hasOwnProperty.call(window,i)||window[i]._instance===o)&&(window[i]=o)}o.update(t)}function F(...o){let[t={}]=o;return"key"in t?new U(...o):new O(...o)}var Pt,St,Z,tt,et,st,it,dt=A(()=>{$();H();V();D();z();J();Pt={createTextNode(){},createDocumentFragment(){return{childNodes:[],appendChild(o){this.removeChild(o),this.childNodes.push(o),o.parentElement=this},insertBefore(o,t){let{childNodes:e}=this;this.removeChild(o);let s=e.indexOf(t);e.splice(s,0,o),o.parentElement=this},removeChild(o){let{childNodes:t}=this,e=t.indexOf(o);e!==-1&&(t.splice(e,1),o.parentElement=null)}}},createElement(o){o=o.toLowerCase();let t=new{scene:O,layer:E,geometry:S,asset:_,node:P}[o];return Object.assign(t,{tagName:o,childNodes:[],appendChild:e=>t.add(e),insertBefore:e=>t.add(e),removeChild:e=>e.destroy()})}};St={scene:O.defaultProps,layer:E.defaultProps,geometry:S.defaultProps,asset:_.defaultProps,node:P.defaultProps},Z=[Pt,wt,St],tt=0,et=1,st=2,it=3});var ut=A(()=>{$();H();V();D();z();J();dt()});var Et=xt((fe,ot)=>{ut();Object.assign(F,{Scene:O,Layer:E,Geometry:S,Asset:_,Node:P,Control:U,controls:N,framework:Z,LEFT:tt,RIGHT:et,BOTTOM:st,TOP:it});typeof window=="object"?window.spective=F:typeof ot=="object"&&(ot.exports=F)});Et();})();
/*! For license information please see spective.min.js.LEGAL.txt */
