/*! spective 2019-03-25 */

!function(){"use strict";var o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};function L(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(){for(var e=[],n=[],t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return i.forEach(function(t){"object"===(void 0===t?"undefined":g(t))?(n=[function(t){var r=f({},t),e=r.scale;"number"==typeof e&&(r.scale=Array(3).fill(e));var n={};return["scale","angle","offset","heading","position"].forEach(function(i){var t=r[i];Array.isArray(t)&&t.forEach(function(t,e){var n=""+i+"XYZ"[e];"number"!=typeof r[n]&&(r[n]=t)})}),["scaleX","scaleY","scaleZ","angleX","angleY","angleZ","offsetX","offsetY","offsetZ","headingX","headingY","headingZ","positionX","positionY","positionZ"].forEach(function(t){var e=r[t];"number"==typeof e&&(n[t]=e)}),n}(t)],e.push(n)):n.push(t)}),e}var n=function(){function t(){u(this,t)}return e(t,[{key:"activate",value:function(){arguments.length&&(this.timestamp=Date.now(),this.queue=s.apply(void 0,arguments));var t=this.queue,e=!t.length,n=t.shift()||[],i=o(n,2),r=i[0],a=i[1];if(this.changes=r,this.iterator=a,this.duration=void 0,e)return this.timestamp=void 0,this.existing=void 0,this.looping=void 0,void(this.iteration=void 0);this.looping="function"==typeof a,this.iteration=-1,this.iterate(),arguments.length&&this.animate(this.timestamp)}},{key:"iterate",value:function(){this.existing=f({},this.properties),this.iteration++;var t=this.looping,e=this.iterator,n=this.iteration,i=this.duration;0<(i=t?e(n):n?0:e)?this.duration=i:(0===n&&this.interpolate(1),this.activate())}},{key:"interpolate",value:function(t){var e=this.existing,n=this.changes,i=this.properties,r=1-(this.looping?0:t);for(var a in n){var o=e[a]||0,s=n[a]*t;i[a]=o*r+s}}},{key:"animate",value:function(t){for(var e=this.timestamp,n=this.properties,i=this.duration,r=t-e;i<=r;)this.interpolate(1),this.timestamp+=i,r-=i,this.iterate(),i=this.duration;if(0<i){var a=r/i;this.interpolate(a)}this.calculate(n)}}]),t}(),b=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function l(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},u=arguments[1],c=arguments[2],e=t.positionX,n=t.positionY,i=t.positionZ,r=t.headingX,a=t.headingY,o=t.headingZ,s=t.offsetX,h=t.offsetY,l=t.offsetZ,f=t.angleX,v=t.angleY,p=t.angleZ,d=t.scaleX,m=t.scaleY,g=t.scaleZ,y=[[e,n,i].some(function(t){return void 0!==t})?[e,n,i]:void 0,a,r,o,[s,h,l].some(function(t){return void 0!==t})?[s,h,l]:void 0,v,f,p,[d,m,g].some(function(t){return void 0!==t})?[d,m,g]:void 0].map(function(t,e){var n=b.slice();if(void 0!==t){if(0<e&&e<4||4<e&&e<8){var i=Math.cos(t),r=Math.sin(u?-t:t),a=e%4,o=5*(3-a),s=1===a?-2:1;[i,r,-r,i].forEach(function(t,e){n[o+(2<=e?s<<2:0)+e%2*s]=t})}else{if(c)return;8===e?t.forEach(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=arguments[1];n[5*e]=u?1/(t||1):t}):t.forEach(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1];n[12+e]=u?-t:t})}return n}});return u&&y.reverse(),y.some(function(t){return t})?y.filter(function(t){return t}):[b.slice()]}function v(t){return t.reduce(function(t,e){if(!e)return t;for(var n=[],i=0;i<4;i++)for(var r=0;r<4;r++){for(var a=4*i,o=0,s=0;s<4;s++)o+=e[a+s]*t[4*s+r];n[a+r]=o}return n})}var y=function(t){function a(t){for(var e=arguments.length,n=Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];u(this,a);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return!0===t?r.inverted=!0:t instanceof a&&(t.children||(t.children=[]),t.children.push(r),r.anchor=t),r.properties={scaleX:1,scaleY:1,scaleZ:1},r.animations=[],n.length||(n=[{}]),r.activate.apply(r,L(n)),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,n),e(a,[{key:"calculate",value:function(t){var e=this.inverted,n=this.anchor,i=this.children,r=void 0===i?[]:i,a=void 0,o=void 0;if(t&&(a=l(t,e),o=l(t,!e,!0),this.relativeMatrix=v(a),this.relativeInverse=v(o)),n){var s=n.relativeMatrix,u=n.relativeInverse,c=n.absoluteMatrix||s,h=n.absoluteInverse||u;this.absoluteMatrix=v([c,this.relativeMatrix]),this.absoluteInverse=v([h,this.relativeInverse])}r.forEach(function(t){return t.calculate()})}}]),a}(),c="0123456789abcdef";var h=/^(#[0-9a-f]{3}|#[0-9a-f]{6})$/,i=function(){function s(t){var n,i,e,r=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};if(u(this,s),h.test(t))this.image=(i=4<(n=t).length?1:0,e=[0,1,2].map(function(t){var e=1+(t<<i);return(c.indexOf(n[e])<<4)+c.indexOf(n[e+i])}),new Uint8Array([].concat(L(e),[255])));else{var o=new window.Image;o.src=t,o.addEventListener("load",function(){r.image=function(t){var e=t.width,n=t.height,i=E(e),r=E(n);if(i===e&&r===n)return t;var a=document.createElement("canvas"),o=a.getContext("2d");return a.width=i,a.height=r,o.drawImage(t,0,0,i,r),o.getImageData(0,0,i,r)}(o),a(t)}),o.addEventListener("error",function(){return a(t)})}this.instances=[]}return e(s,[{key:"createInstance",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=new(Function.prototype.bind.apply(y,[null].concat(e)));return this.instances.push(i),i}},{key:"destroyInstance",value:function(t,e){if(e){for(var n=t.anchor;n&&n!==e;)n=n.anchor;if(!n)return}var i=this.instances;i.splice(i.indexOf(t),1)}}]),s}();function d(a,t,e,n,o){var i=a<0,r=n<0?-1:1,s=o<0,u=s&&!e,c=s&&e;a=Math.abs(a),n=Math.abs(n),o=Math.abs(o);var h=1/a,l=2*Math.PI*h,f=[],v=0;e||(v=(o?-h:h)/2);for(var p=0;p<=a;p++){var d=p*l,m=-Math.sin(d),g=-Math.cos(d);i?f.push("vt "+(.5+m*n*r)+" "+(.5+-g*n)):f.push("vt "+(p*h+v)+" "+n),p<a&&f.push("v "+m*Math.abs(e)+" "+t+" "+g*e)}return o&&Array(a).fill(a*o+1).forEach(function(t,e){var n=e<a-1,i=t+e+1,r=i-a-1;s&&!c||f.push("f "+[[i-1,i+o-1].join("/"),[c?t-1:r,r+(o-1)].join("/"),[n?i:t,i+o].join("/")].join(" ")),s&&!u||f.push("f "+[[n?r+1:t-a,r+o].join("/"),[u?t:n?i:t,i+o].join("/"),[r,r+(o-1)].join("/")].join(" "))}),f.join("\n")}function p(){switch(arguments.length){case 3:return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return x(["v "+t+" 0 0","v "+t+" 0 "+n,"v 0 0 "+n,"v 0 0 0","v "+t+" "+e+" 0","v "+t+" "+e+" "+n,"v 0 "+e+" "+n,"v 0 "+e+" 0","vt 0 0","vt 0 "+e,"vt "+t+" 0","vt "+t+" "+e,"vt "+n+" 0","vt "+n+" "+e,"vt 0 "+n,"vt "+t+" "+n,"f 1/7 2/1 3/3 4/8","f 5/8 8/7 7/1 6/3","f 1/5 5/6 6/2 2/1","f 2/3 6/4 7/2 3/1","f 3/5 7/6 8/2 4/1","f 5/2 1/1 4/3 8/4"].join("\n"),1)}.apply(void 0,arguments);case 2:return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:3,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=t<3;t=Math.abs(t);var i=Math.floor(t%1);t=Math.max(Math.floor(t),2);var r=[];return r.push(d(-t,0,0,0,0)),r.push(d(-t,0,.5,-.5,1)),r.push(d(t,0,.5,0)),n?r.push(d(t,e,0,e,-3)):(r.push(d(t,e,.5,e,3)),r.push(d(-t,e,.5,.5)),r.push(d(-t,e,0,0,-5))),x(r.join("\n"),i)}.apply(void 0,arguments);default:return function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=t<1;t=Math.abs(t);var n=Math.floor(t%1),i=(t=Math.floor(t))+1;t=e?2*t+1:t;for(var r=Math.floor(1.5*t+2),a=1/i,o=e?-1:1,s=e?500:.5,u=[],c=e?Math.PI/2:0,h=(Math.PI-c)/i,l=0;l<i;l++){var f=-Math.cos(c)*s,v=Math.sin(c)*s*o,p=l*a;u.push(d(r,f,v,p,l)),c+=h}return u.push(d(r,s,0,1,-i)),x(u.join("\n"),n)}.apply(void 0,arguments)}}function T(t,e,n,i,r,a){return(t*(i-a)+n*(a-e)+r*(e-i))/2}function I(t){var e=Math.max.apply(Math,L(t.map(function(t){return Math.abs(t)})));return 0===e?t:t.map(function(t){return t/e})}function _(t){for(var e=t.length/3,n=[0,0,0],i=0;i<t.length;i+=3)n[0]+=t[i],n[1]+=t[i+1],n[2]+=t[i+2];return I(n.map(function(t){return t/e}))}function m(t,e,n){var i=t.match(new RegExp("(^|\n)"+e+" [^\n]+","g"));if(i)return i.map(function(t){return t.split(/ +/).slice(1).map(function(t){return n?t.split("/").map(function(t){return 0<t?t-1:Number(t)}):Number(t)})})}function A(t,n,i){var e;return(e=[]).concat.apply(e,L(t.map(function(t){var e=t[n];return i?i[e+(e<0?i.length:0)]:e})))}function x(t,e){var o=m(t,"v");if(o){var n,s=m(t,"vt"),u=m(t,"vn"),i=m(t,"f",!0),c=[],h=[],l=[],f=[];if(i.forEach(function(t){for(var e=t.length-1,n=1;n<e;n++){var i,r,a=[t[0],t[n],t[n+1]];if(c.push.apply(c,L(A(a,0))),h.push.apply(h,L(A(a,0,o))),s)(i=l).push.apply(i,L(A(a,1,s)));if(u)(r=f).push.apply(r,L(A(a,2,u)))}}),s||(l=h.filter(function(t,e){return e%3!=1}).map(function(t,e){return e%2==1?-t:t})),!u)f=function(t,e){for(var n,i,r,a=t.map(function(t){return t<0?e.length+t:t}),o=Math.max.apply(Math,L(a))+1,s=[],u=[],c=0;c<o;c++)u[c]=[];for(var h=0;h<a.length;h+=3){var l=a[h],f=a[h+1],v=a[h+2],p=3*l,d=3*f,m=3*v,g=e.slice(p,p+3),y=e.slice(d,d+3),b=e.slice(m,m+3),A=(i=y,r=b,I([T((n=g)[1],n[2],i[1],i[2],r[1],r[2]),T(n[2],n[0],i[2],i[0],r[2],r[0]),T(n[0],n[1],i[0],i[1],r[0],r[1])]));u[l]=u[l].concat(A),u[f]=u[f].concat(A),u[v]=u[v].concat(A)}u=u.map(_);for(var x=0;x<a.length;x+=3){var E=u[a[x]],M=u[a[x+1]],w=u[a[x+2]];s.push.apply(s,L(E).concat(L(M),L(w)))}return s}(c,(n=[]).concat.apply(n,L(o)));var r=Math.min.apply(Math,L(l)),a=Math.max.apply(Math,L(l));return{vertices:new Float32Array(h),coordinates:new Float32Array(l),normals:new Float32Array(f),repeatTexture:r<0||1<a}}}function E(t){return Math.pow(2,Math.ceil(Math.log2(t)))}var M=/^ *-?[0-9]+(\.[0-9]+)?( +-?[0-9]+(\.[0-9]+)?){0,2} *$/,r=function(){function o(e){var n=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};if(u(this,o),this.assets={},M.test(e)){var t=e.trim().split(/ +/g).map(function(t){return Number(t)}),r=p.apply(void 0,L(t));Object.assign(this,r)}else{var a=new XMLHttpRequest;a.onload=function(){var t=a.status;200!==t&&404!==t||(200===t&&Object.assign(n,x(a.responseText)),i(e))},a.open("GET",e),a.send()}}return e(o,[{key:"createAsset",value:function(t,e){var n=this.assets[t];return n||(n=new i(t,e),this.assets[t]=n),n}},{key:"destroyAsset",value:function(t,e){if(e)for(var n=this.assets[t],i=n.instances,r=i.length-1;0<=r;r--)n.destroyInstance(i[r],e);else delete this.assets[t]}}]),o}(),w=function(){function o(t,e){u(this,o);var n=t.getContext("webgl"),i=n.createProgram(),r=n.createShader(n.VERTEX_SHADER),a=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(r,"\n\tuniform mat4 uInstance;\n\tuniform mat4 uInverse;\n\tuniform mat4 uScene;\n\tuniform mat4 uPerspective;\n\n\tattribute vec3 aVertex;\n\tattribute vec3 aNormal;\n\tattribute vec2 aCoordinate;\n\n\tvarying vec3 vNormal;\n\tvarying vec3 vDirection;\n\tvarying vec2 vCoordinate;\n\n\tvoid main() {\n\t\tgl_Position = uPerspective * uScene * uInstance * vec4(aVertex, 1);\n\t\tvNormal = aNormal;\n\t\tvDirection = normalize(uInverse * vec4(1, 1, 1, 1)).xyz;\n\t\tvCoordinate = aCoordinate;\n\t}\n"),n.shaderSource(a,"\n\tprecision mediump float;\n\n\tuniform sampler2D uImage;\n\n\tvarying vec3 vNormal;\n\tvarying vec3 vDirection;\n\tvarying vec2 vCoordinate;\n\n\tvoid main() {\n\t\tfloat intensity = 0.5 + 0.5 * (dot(vDirection, vNormal) + 0.7) / 1.7;\n\t\tvec3 color = texture2D(uImage, vCoordinate).xyz * intensity;\n\t\tgl_FragColor = vec4(color, 1);\n\t}\n"),n.compileShader(r),n.compileShader(a),n.attachShader(i,r),n.attachShader(i,a),n.linkProgram(i),n.useProgram(i),n.enable(n.DEPTH_TEST),n.depthFunc(n.LESS),n.enable(n.CULL_FACE),n.cullFace(n.BACK),n.clearColor(0,0,0,1),this.setAttribute=this.setAttribute.bind(this),this.setSampler=this.setSampler.bind(this),this.resize=this.resize.bind(this),this.toggle=this.toggle.bind(this),this.render=this.render.bind(this),this.createGeometry=this.createGeometry.bind(this),this.destroyGeometry=this.destroyGeometry.bind(this),this.canvas=t,this.gl=n,this.camera=e,this.geometries={},this.instanceLocation=n.getUniformLocation(i,"uInstance"),this.inverseLocation=n.getUniformLocation(i,"uInverse"),this.sceneLocation=n.getUniformLocation(i,"uScene"),this.perspectiveLocation=n.getUniformLocation(i,"uPerspective"),this.imageLocation=n.getUniformLocation(i,"uImage"),this.vertexLocation=n.getAttribLocation(i,"aVertex"),this.normalLocation=n.getAttribLocation(i,"aNormal"),this.coordinateLocation=n.getAttribLocation(i,"aCoordinate")}return e(o,[{key:"setAttribute",value:function(t,e,n,i){var r=this.gl,a=r.ARRAY_BUFFER;return i=i||r.createBuffer(),r.bindBuffer(a,i),r.enableVertexAttribArray(t),r.bufferData(a,e,r.STATIC_DRAW),r.vertexAttribPointer(t,n,r.FLOAT,!1,0,0),i}},{key:"setSampler",value:function(t,e,n,i,r){var a=this.gl,o=a.TEXTURE_2D,s=a.RGBA,u=a.CLAMP_TO_EDGE,c=i instanceof Uint8Array,h=c?[i.length/4,1,0]:[];return r=r||a.createTexture(),a.activeTexture(a["TEXTURE"+e]),a.bindTexture(o,r),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D.apply(a,[o,0,s].concat(h,[s,a.UNSIGNED_BYTE,i])),c||(a.generateMipmap(o),a.texParameteri(o,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR)),n||(a.texParameteri(o,a.TEXTURE_WRAP_S,u),a.texParameteri(o,a.TEXTURE_WRAP_T,u)),a.uniform1i(t,e),r}},{key:"resize",value:function(){var t=this.render,e=this.canvas,n=this.gl,i=this.perspectiveLocation,r=e.clientWidth,a=e.clientHeight,o=Math.max(r,a);e.width=r,e.height=a,n.viewport(0,0,r,a),n.uniformMatrix4fv(i,!1,[o/r,0,0,0,0,o/a,0,0,0,0,-1,-1,0,0,-2,0]),t()}},{key:"toggle",value:function(){this.locked=!this.locked,this.locked||this.resize()}},{key:"render",value:function(t){if(this.locked)this.resolved=void 0;else{var e=this.render,h=this.setAttribute,l=this.setSampler,f=this.gl,n=this.camera,i=this.geometries,r=this.resolved,a=this.sceneLocation,v=this.vertexLocation,p=this.normalLocation,d=this.coordinateLocation,m=this.imageLocation,g=this.instanceLocation,y=this.inverseLocation;if(void 0===r||void 0!==t&&!r){f.clear(f.COLOR_BUFFER_BIT),f.clear(f.DEPTH_BUFFER_BIT);var b=Date.now(),A=!0;n.timestamp&&(n.animate(b),A=A&&!n.timestamp),f.uniformMatrix4fv(a,!1,n.relativeMatrix),Object.values(i).forEach(function(t){var e=t.vertices,n=t.normals,i=t.coordinates,r=t.repeatTexture,a=t.assets,o=t.vertexBuffer,s=t.normalBuffer,u=t.coordinateBuffer;if(e){var c=e.length/3;t.vertexBuffer=h(v,e,3,o),t.normalBuffer=h(p,n,3,s),t.coordinateBuffer=h(d,i,2,u),Object.values(a).forEach(function(t){var e=t.image,n=t.instances,i=t.imageTexture;e&&(t.imageTexture=l(m,0,r,e,i),n.forEach(function(t){t.timestamp&&(t.animate(b),A=A&&!t.timestamp);var e=t.absoluteMatrix,n=t.absoluteInverse,i=t.relativeMatrix,r=t.relativeInverse;f.uniformMatrix4fv(g,!1,e||i),f.uniformMatrix4fv(y,!1,n||r),f.drawArrays(f.TRIANGLES,0,c)}))})}}),this.resolved=A,window.requestAnimationFrame(e)}else this.resolved=void 0!==t&&void 0}}},{key:"createGeometry",value:function(t,e){var n=this.geometries[t];return n||(n=new r(t,e),this.geometries[t]=n),n}},{key:"destroyGeometry",value:function(t,e){if(e){var n=this.geometries[t],i=n.assets;for(var r in i)n.destroyAsset(r,e)}else delete this.geometries[t]}}]),o}();function k(t){return 1/t<0}function S(t,e,n){return Math.min(Math.max(t,e),n)}var j=function(){function o(){u(this,o);for(var t=[],e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];for(;"number"==typeof n.slice(-1)[0];)t.unshift(n.pop());if(this.segments=function(){for(var i=[],t=[],e=0,n=0,r=void 0,a=arguments.length,o=Array(a),s=0;s<a;s++)o[s]=arguments[s];for(;o.length;){var u=o.shift();"function"==typeof u?(void 0!==r?e+=r:n++,i.push(u),t.push(r),r=void 0):"number"==typeof u&&(r=u)}var c=0,h=void 0;t.length?1<t.length&&void 0===t[0]&&(t.shift(),n--,h=i.shift()):(t.push(r),n=1);var l=n?(1-e%1)/n:0;return t.map(function(t,e){var n={lowerValue:c,lowerCallback:h};return c+=void 0!==t?t:l,h=i[e],f({},n,{upperValue:c,upperCallback:h})})}.apply(void 0,n),this.index=0,this.value=0,this.change=0,this.resolve=this.resolve.bind(this),t.length){var r=t[0],a=t[1];k(r)&&void 0!==a&&this.update(-0),this.update(r,a)}}return e(o,[{key:"measure",value:function(){var t=this.segments,e=this.change,n=this.duration,i=this.timestamp,r=this.value;void 0!==n&&void 0!==i&&(r-=e*(1-S(0,(Date.now()-i)/n,1)||0));k(e)&&(r-=t.slice(-1)[0].upperValue);return r}},{key:"resolve",value:function(){var t=this.segments,e=this.value,n=this.change,i=this.duration,r=this.index,a=t[r],o=t.length,s=a.lowerValue,u=a.lowerCallback,c=a.upperValue,h=a.upperCallback,l=k(n)?-1:1,f=void 0;c<=e&&0<l?f=h:e<=s&&l<0?f=u:l=0,r+=l,l&&0<=r&&r<o&&(this.index=r,this.schedule()),f&&void 0!==i&&f(l)}},{key:"schedule",value:function(){var t=this.resolve,e=this.segments,n=this.index,i=this.value,r=this.change,a=this.duration,o=e[n],s=o.lowerValue,u=o.upperValue,c=S(s,i,u);if(c===s||c===u)if(void 0!==a){var h=i-r,l=S(s,h,u),f=r?(r-(l-h+(i-c)))/r:1,v=Math.round(a*f);this.timeout=setTimeout(t,v)}else t()}},{key:"update",value:function(t,e){isNaN(t)&&(t=0,e=e||0);var n=this.segments,i=this.timeout,r=n.slice(-1)[0].upperValue,a=void 0===e,o=this.measure(),s=void 0,u=k(o);o+=u?r:0,a?(s=(t+=k(t)?r:0)-o,o=t):o+=s=t;var c=S(0,o,r),h=s-(o-c);if(h||(h=u?-0:0),this.value=c,this.change=h,this.timeout=clearTimeout(i),a)this.duration=void 0,this.timestamp=void 0;else{var l=h/s||1;this.duration=e*l,this.timestamp=Date.now()}h&&this.schedule()}}]),o}(),P=/(\.(bmp|gif|jpe?g|png|svg)|#[0-9a-f]{3}|#[0-9a-f]{6}) *$/,t=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0];if(/function|number/.test(void 0===i?"undefined":g(i))||!e.length){var r=new(Function.prototype.bind.apply(j,[null].concat(e)));return function(){return arguments.length?r.update.apply(r,arguments):r.measure()}}var a,o,s,u=i,c=!u||"function"!=typeof u.getContext;c?(a=document.createElement("canvas"),o=document.body,(s=document.createElement("style")).innerHTML="\n\t\tbody { margin: 0; }\n\t\tcanvas {\n\t\t\tdisplay: block;\n\t\t\twidth: 100vw;\n\t\t\theight: 100vh;\n\t\t\tposition: absolute;\n\t\t\tleft: 0;\n\t\t\ttop: 0;\n\t\t}\n\t",o.appendChild(s),o.appendChild(a),u=a):e.shift();var h=new(Function.prototype.bind.apply(y,[null].concat([!0],e))),l=new w(u,h),f=l.resize,v=l.toggle,p=l.render,d=l.createGeometry,m=l.destroyGeometry;return f(),c&&window.addEventListener("resize",f),function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(0===e.length)v();else{if("string"==typeof e[0])return function i(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var a=void 0,o=void 0;if(P.test(n[0])||(a=n.shift()),P.test(n[0]))o=n.shift();else if(!n.length)return void m(a,t);o=o||"#fff";var s=d(a=a||"1 1 1",p);if(!n.length)return s.destroyAsset(o,t),void(Object.keys(s.assets).length||m(a,t));var u=s.createAsset(o,p),c=u.createInstance.apply(u,[t].concat(n)),h=[];return p(),function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length){if("string"==typeof e[0])return h.push(i.apply(void 0,[c].concat(e))),h[h.length-1];c.activate.apply(c,e),p()}else u.destroyInstance(c),u.instances.length||(s.destroyAsset(o),Object.keys(s.assets).length||m(a)),h.forEach(function(t){return t()})}}.apply(void 0,[!1].concat(e));h.activate.apply(h,e),p()}}};window.spective=t,"function"==typeof define&&define.amd&&define("spective",function(){return t})}();